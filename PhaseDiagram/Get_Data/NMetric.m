function sol = NMetric
global X;
solinit = bvpinit(X,@guess);
options = bvpset('RelTol',1e-5,'Stats','on');
sol = bvp4c(@bvpfcn, @bcfcn, solinit,options);
end

function dydx = bvpfcn(x,y)
global t12 t23 t13;
p1=y(1);
p2=y(2);

gamma111 = (1/2).*p1.^(-1).*((-1)+p1+p2).^(-1).*(p1+p2).^(-1).*(((-1)+p2).* ...
  p2.*(t12+t13).*t23+p1.^2.*t13.*(t12+t23)+(-1).*p1.*t13.*(t12+t23+( ...
  -2).*p2.*t23)).^(-2).*((-1).*((-1)+p2).^3.*p2.^3.*(t12+t13).^2.* ...
  t23.^2+(-2).*p1.^6.*t13.^2.*(t12+t23).^2+p1.*((-1)+p2).^2.*p2.^2.* ...
  (t12+t13).*t23.*((3+(-7).*p2).*t13.*t23+t12.*(2.*t13+(-1).*p2.* ...
  t23))+(-1).*p1.^2.*((-1)+p2).*p2.*((3+(-18).*p2+20.*p2.^2).* ...
  t13.^2.*t23.^2+t12.^3.*((-1).*t13+((-1)+p2).^2.*t23)+t12.*t13.* ...
  t23.*(2.*(2+(-6).*p2+p2.^2).*t13+(1+(-10).*p2+11.*p2.^2).*t23)+ ...
  t12.^2.*(t13.^2+p2.*((-4)+3.*p2).*t13.*t23+((-1)+p2).^2.*t23.^2))+ ...
  p1.^5.*t13.*(t12+t23).*(5.*t13.*(t12+t23)+p2.*(t12.^2+(-11).*t13.* ...
  t23+t12.*((-3).*t13+t23)))+p1.^4.*t13.*((-4).*t13.*(t12+t23).^2+ ...
  p2.^2.*(t12.^3+(-1).*t12.^2.*(t13+(-2).*t23)+(-25).*t13.*t23.^2+ ...
  t12.*t23.*((-18).*t13+t23))+(-1).*p2.*(t12+t23).*(3.*t12.^2+(-23) ...
  .*t13.*t23+(-1).*t12.*(7.*t13+t23)))+(-1).*p1.^3.*((-1).*t13.^2.*( ...
  t12+t23).^2+p2.^3.*t23.*(t12.^3+30.*t13.^2.*t23+5.*t12.*t13.*(2.* ...
  t13+t23)+t12.^2.*(3.*t13+t23))+p2.*(t12+t23).*(15.*t13.^2.*t23+ ...
  t12.^2.*((-3).*t13+t23)+t12.*t13.*(5.*t13+3.*t23))+p2.^2.*(2.* ...
  t12.^3.*(t13+(-1).*t23)+(-42).*t13.^2.*t23.^2+(-1).*t12.*t13.* ...
  t23.*(32.*t13+9.*t23)+(-1).*t12.^2.*(2.*t13.^2+t13.*t23+2.*t23.^2) ...
  )));
gamma112 = (1/2).*p1.*((-1)+p2).^(-1).*((-1)+p1+p2).^(-1).*(p1+p2).^(-1).*((( ...
  -1)+p2).*p2.*(t12+t13).*t23+p1.^2.*t13.*(t12+t23)+(-1).*p1.*t13.*( ...
  t12+t23+(-2).*p2.*t23)).^(-2).*(((-1)+p1).^2.*p1.*t13.*(t12+t23).* ...
  ((-1).*t12.*t23+p1.^2.*t13.*(t12+t23))+(-1).*p2.^5.*(t12+t13).* ...
  t23.*(t12.^2+(-1).*t13.*t23+t12.*(t13+t23))+p2.^4.*t23.*((-1).*(( ...
  -4)+p1).*t12.^3+((-2)+5.*p1).*t13.^2.*t23+t12.*t13.*((2+(-3).*p1) ...
  .*t13+2.*t23)+t12.^2.*((6+(-4).*p1).*t13+(-1).*((-4)+p1).*t23))+ ...
  p2.^2.*(p1.*(3+(-12).*p1+10.*p1.^2).*t13.^2.*t23.^2+t12.^3.*(((-2) ...
  +p1).*((-1)+p1).^2.*t13+(4+(-3).*p1).*t23)+t12.*t13.*t23.*(5.* ...
  p1.^3.*t13+(-4).*p1.^2.*(t13+(-1).*t23)+4.*t23+(-10).*p1.*t23)+ ...
  t12.^2.*(((-2)+p1).*((-1)+p1).^2.*t13.^2+(4+(-11).*p1+4.*p1.^2+ ...
  p1.^3).*t13.*t23+(4+(-3).*p1).*t23.^2))+p2.^3.*((1+(-8).*p1+10.* ...
  p1.^2).*t13.^2.*t23.^2+t12.^3.*(((-1)+p1).^2.*t13+3.*((-2)+p1).* ...
  t23)+(-1).*t12.*t13.*t23.*((1+(-3).*p1+p1.^2).*t13+(-5).*((-1)+p1) ...
  .*t23)+t12.^2.*(((-1)+p1).^2.*t13.^2+(-1).*(7+(-10).*p1+p1.^2).* ...
  t13.*t23+3.*((-2)+p1).*t23.^2))+((-1)+p1).*p2.*(p1.^2.*((-3)+5.* ...
  p1).*t13.^2.*t23.^2+t12.^3.*((-1).*((-1)+p1).^2.*t13+t23)+t12.* ...
  t13.*t23.*(6.*p1.^3.*t13+t23+(-5).*p1.*t23+p1.^2.*((-3).*t13+t23)) ...
  +t12.^2.*(((-1)+2.*p1+(-2).*p1.^2+p1.^3).*t13.^2+t23.^2+t13.*(t23+ ...
  (-5).*p1.*t23))));
gamma122 = (1/2).*p1.*((-1)+p2).^(-1).*p2.^(-1).*((-1)+p1+p2).^(-1).*(p1+p2) ...
  .^(-1).*(((-1)+p2).*p2.*(t12+t13).*t23+p1.^2.*t13.*(t12+t23)+(-1) ...
  .*p1.*t13.*(t12+t23+(-2).*p2.*t23)).^(-2).*((-1).*p2.^6.*(t12+t13) ...
  .^3.*t23+(-1).*p2.^5.*(t12+t13).^2.*(((-4)+p1).*t12+((-2)+5.*p1).* ...
  t13).*t23+(-1).*((-1)+p1).^3.*p1.^2.*t12.*t13.^2.*(t12+t23)+((-1)+ ...
  p1).^2.*p1.*p2.*t13.^2.*((1+(-4).*p1+3.*p1.^2).*t12.^2+((-1)+p1) ...
  .^2.*t12.*t13+p1.*((-2)+3.*p1).*t12.*t23+(-1).*p1.^2.*t13.*t23)+ ...
  p2.^4.*(t12+t13).*(((-1)+8.*p1+(-10).*p1.^2).*t13.^2.*t23+t12.^2.* ...
  (((-1)+p1).^2.*t13+3.*((-2)+p1).*t23)+t12.*t13.*(((-1)+p1).^2.* ...
  t13+((-7)+15.*p1+(-2).*p1.^2).*t23))+p2.^3.*(p1.*((-3)+12.*p1+( ...
  -10).*p1.^2).*t13.^3.*t23+t12.^3.*(((-2)+p1).*((-1)+p1).^2.*t13+( ...
  4+(-3).*p1).*t23)+t12.*t13.^2.*(((-1)+p1).^2.*((-2)+3.*p1).*t13+( ...
  4+(-17).*p1+16.*p1.^2).*t23)+t12.^2.*t13.*(4.*((-1)+p1).^3.*t13+( ...
  8+(-17).*p1+4.*p1.^2+2.*p1.^3).*t23))+(-1).*((-1)+p1).*p2.^2.*( ...
  t12.^3.*(((-1)+p1).^2.*t13+(-1).*t23)+p1.^2.*((-3)+5.*p1).* ...
  t13.^3.*t23+t12.^2.*t13.*((2+(-7).*p1+10.*p1.^2+(-5).*p1.^3).*t13+ ...
  2.*((-1)+2.*p1+p1.^2).*t23)+(-1).*t12.*t13.^2.*(((-1)+p1).^2.*(( ...
  -1)+3.*p1).*t13+(1+(-4).*p1+p1.^2+7.*p1.^3).*t23)));
gamma211 = (1/2).*((-1)+p1).^(-1).*p1.^(-1).*p2.*((-1)+p1+p2).^(-1).*(p1+p2) ...
  .^(-1).*(((-1)+p2).*p2.*(t12+t13).*t23+p1.^2.*t13.*(t12+t23)+(-1) ...
  .*p1.*t13.*(t12+t23+(-2).*p2.*t23)).^(-2).*((-1).*((-1)+p2).^3.* ...
  p2.^2.*t12.*(t12+t13).*t23.^2+(-1).*p1.^6.*t13.*(t12+t23).^3+(-1) ...
  .*p1.^5.*t13.*(t12+t23).^2.*(((-4)+p2).*t12+((-2)+5.*p2).*t23)+ ...
  p1.^4.*(t12+t23).*(((-1)+8.*p2+(-10).*p2.^2).*t13.*t23.^2+t12.^2.* ...
  (3.*((-2)+p2).*t13+((-1)+p2).^2.*t23)+t12.*t23.*(((-7)+15.*p2+(-2) ...
  .*p2.^2).*t13+((-1)+p2).^2.*t23))+p1.^3.*(p2.*((-3)+12.*p2+(-10).* ...
  p2.^2).*t13.*t23.^3+t12.^3.*((4+(-3).*p2).*t13+((-2)+p2).*((-1)+ ...
  p2).^2.*t23)+t12.^2.*t23.*((8+(-17).*p2+4.*p2.^2+2.*p2.^3).*t13+ ...
  4.*((-1)+p2).^3.*t23)+t12.*t23.^2.*((4+(-17).*p2+16.*p2.^2).*t13+( ...
  (-1)+p2).^2.*((-2)+3.*p2).*t23))+p1.^2.*((-1)+p2).*((3+(-5).*p2).* ...
  p2.^2.*t13.*t23.^3+t12.^3.*(t13+(-1).*((-1)+p2).^2.*t23)+t12.* ...
  t23.^2.*((1+(-4).*p2+p2.^2+7.*p2.^3).*t13+((-1)+p2).^2.*((-1)+3.* ...
  p2).*t23)+t12.^2.*t23.*((-2).*((-1)+2.*p2+p2.^2).*t13+((-2)+7.*p2+ ...
  (-10).*p2.^2+5.*p2.^3).*t23))+p1.*((-1)+p2).^2.*p2.*t23.^2.*((1+( ...
  -4).*p2+3.*p2.^2).*t12.^2+(-1).*p2.^2.*t13.*t23+t12.*(t23+(-2).* ...
  p2.*(t13+t23)+p2.^2.*(3.*t13+t23))));
gamma212 = (1/2).*((-1)+p1).^(-1).*p2.*((-1)+p1+p2).^(-1).*(p1+p2).^(-1).*((( ...
  -1)+p2).*p2.*(t12+t13).*t23+p1.^2.*t13.*(t12+t23)+(-1).*p1.*t13.*( ...
  t12+t23+(-2).*p2.*t23)).^(-2).*(((-1)+p2).^2.*p2.*(t12+t13).*t23.* ...
  ((-1).*t12.*t13+p2.^2.*t12.*t23+p2.^2.*t13.*t23)+(-1).*p1.^5.* ...
  t13.*(t12+t23).*(t12.^2+(-1).*t13.*t23+t12.*(t13+t23))+p1.^4.* ...
  t13.*((-1).*((-4)+p2).*t12.^3+((-2)+5.*p2).*t13.*t23.^2+t12.*t23.* ...
  (2.*t13+(2+(-3).*p2).*t23)+t12.^2.*((-1).*((-4)+p2).*t13+6.*t23+( ...
  -4).*p2.*t23))+p1.^3.*((1+(-8).*p2+10.*p2.^2).*t13.^2.*t23.^2+ ...
  t12.^3.*(3.*((-2)+p2).*t13+((-1)+p2).^2.*t23)+t12.*t13.*t23.*(5.*( ...
  (-1)+p2).*t13+(-1).*(1+(-3).*p2+p2.^2).*t23)+t12.^2.*(3.*((-2)+p2) ...
  .*t13.^2+(-1).*(7+(-10).*p2+p2.^2).*t13.*t23+((-1)+p2).^2.*t23.^2) ...
  )+p1.^2.*(p2.*(3+(-12).*p2+10.*p2.^2).*t13.^2.*t23.^2+t12.^3.*((4+ ...
  (-3).*p2).*t13+((-2)+p2).*((-1)+p2).^2.*t23)+t12.*t13.*t23.*(2.*( ...
  2+(-5).*p2+2.*p2.^2).*t13+p2.^2.*((-4)+5.*p2).*t23)+t12.^2.*((4+( ...
  -3).*p2).*t13.^2+(4+(-11).*p2+4.*p2.^2+p2.^3).*t13.*t23+((-2)+p2) ...
  .*((-1)+p2).^2.*t23.^2))+p1.*((-1)+p2).*(p2.^2.*((-3)+5.*p2).* ...
  t13.^2.*t23.^2+t12.^3.*(t13+(-1).*((-1)+p2).^2.*t23)+t12.*t13.* ...
  t23.*((1+(-5).*p2+p2.^2).*t13+3.*p2.^2.*((-1)+2.*p2).*t23)+ ...
  t12.^2.*(t13.^2+((-1)+2.*p2+(-2).*p2.^2+p2.^3).*t23.^2+t13.*(t23+( ...
  -5).*p2.*t23))));
gamma222 = (-1/2).*p2.^(-1).*((-1)+p1+p2).^(-1).*(p1+p2).^(-1).*(((-1)+p2).* ...
  p2.*(t12+t13).*t23+p1.^2.*t13.*(t12+t23)+(-1).*p1.*t13.*(t12+t23+( ...
  -2).*p2.*t23)).^(-2).*(((-1)+p2).^2.*p2.^3.*((-1)+2.*p2).*(t12+ ...
  t13).^2.*t23.^2+p1.^6.*t13.^2.*(t12+t23).^2+p1.^5.*t13.^2.*(t12+ ...
  t23).*(((-3)+p2).*t12+((-3)+7.*p2).*t23)+p1.*((-1)+p2).*p2.^2.*( ...
  t12+t13).*((3+(-12).*p2+11.*p2.^2).*t13.*t23.^2+t12.^2.*(t13+(-1) ...
  .*((-1)+p2).^2.*t23)+t12.*t23.*(t13+(-2).*p2.*t13+(-1).*p2.^2.* ...
  t13+t23+(-4).*p2.*t23+3.*p2.^2.*t23))+p1.^4.*t13.*(3.*t13.*(t12+ ...
  t23).^2+(-1).*p2.*(t12+t23).*(17.*t13.*t23+2.*t12.*(t13+t23))+ ...
  p2.^2.*(t12.^3+20.*t13.*t23.^2+t12.*t23.*(11.*t13+2.*t23)+t12.^2.* ...
  (t13+3.*t23)))+p1.^3.*t13.*((-1).*t13.*(t12+t23).^2+p2.^3.*( ...
  t12.^3+30.*t13.*t23.^2+5.*t12.*t23.*(t13+2.*t23)+t12.^2.*(t13+3.* ...
  t23))+p2.*(t12+t23).*(13.*t13.*t23+t12.*(t13+4.*t23))+(-1).* ...
  p2.^2.*(3.*t12.^3+38.*t13.*t23.^2+7.*t12.*t23.*(3.*t13+2.*t23)+ ...
  t12.^2.*(3.*t13+7.*t23)))+(-1).*p1.^2.*p2.*(t13.*(2.*t12+3.*t13).* ...
  t23.*(t12+t23)+p2.^3.*t23.*(t12.^3+t12.*t13.*(t13+(-18).*t23)+ ...
  t12.^2.*(2.*t13+(-1).*t23)+(-25).*t13.^2.*t23)+(-1).*p2.*(t12.^3.* ...
  (3.*t13+(-1).*t23)+21.*t13.^2.*t23.^2+t12.*t13.*t23.*(11.*t13+16.* ...
  t23)+t12.^2.*(3.*t13.^2+4.*t13.*t23+t23.^2))+p2.^2.*(2.*t12.^3.*( ...
  t13+(-1).*t23)+42.*t13.^2.*t23.^2+t12.*t13.*t23.*(9.*t13+32.*t23)+ ...
  t12.^2.*(2.*t13.^2+t13.*t23+2.*t23.^2))));


dydx = zeros(4,1);
dydx = [y(3);y(4);-(gamma111.*y(3).*y(3)+2.*gamma112*y(3)*y(4)+gamma122*y(4)*y(4));-(gamma211*y(3)*y(3)+2*gamma212*y(3)*y(4)+gamma222*y(4)*y(4))];
end

function res = bcfcn(ya,yb) % boundary conditions
    res = [ya(1)-0.8;yb(1)-0.1;ya(2)-0.1;yb(2)-0.8];
end

function g = guess(x) % initial guess for y and y'
    global X Y;
    [m,n]=find(X==x);
    g=[Y(1,n);Y(2,n);Y(3,n);Y(4,n)];
end
